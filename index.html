<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Surprise</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #ffe6e6, #fff0f5);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    min-height: 100vh;
    margin: 0;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 1.5s ease;
    width: 100%;
    max-width: 450px;
  }

  h1 {
    font-family: 'Fredoka One', cursive;
    color: #d60000;
    font-size: 2em;
    text-align: center;
    margin-bottom: 20px;
  }

  .input-boxes {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    justify-content: center;
  }

  .box {
    flex: 1;
    max-width: 60px;
    height: 60px;
    min-width: 50px;
    border: 3px solid #d60000;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s, background-color 0.2s;
    background-color: #fff;
    color: #fff;
    font-weight: bold;
  }

  .keyboard {
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: opacity 1.5s ease;
    width: 100%;
  }

  .keyboard.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .row {
    display: flex;
    justify-content: center;
    gap: 5px;
    flex-wrap: nowrap;
  }

  #row1 .key { flex: 0 0 calc((100% - 9*5px)/10); }
  #row2 .key { flex: 0 0 calc((100% - 8*5px)/9); }
  #row3 .key { flex: 0 0 calc((100% - 8*5px)/9); }

  .key {
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #ccc;
    color: white;
    font-weight: bold;
    user-select: none;
    transition: all 0.2s;
    cursor: not-allowed;
    font-size: 16px;
    box-shadow: 0 3px 5px rgba(0,0,0,0.2);
  }

  .key.highlight { background-color: #d60000; cursor: pointer; }
  .key.highlight:hover { transform: scale(1.2); }
  .key.special { background-color: #ff6600; cursor: pointer; }
  .key.special:hover { transform: scale(1.1); }

  #message { margin-top: 10px; font-size: 20px; color: #d60000; text-align: center; font-weight: 600; }
  #shortMessage { margin-top: 10px; font-size: 16px; color: #333; text-align: center; display: none; }
  #loading { font-size: 18px; margin-top: 10px; display: none; text-align: center; }
  .dot { animation: blink 1s infinite; }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes blink { 0%,50%,100%{opacity:0;} 25%,75%{opacity:1;} }

  #proceedBtn { margin-top: 20px; padding: 10px 20px; font-size: 18px; background-color: #d60000; color: white; border: none; border-radius: 10px; cursor: pointer; display: none; transition: transform 0.2s, background-color 0.2s; }
  #proceedBtn:hover { background-color: #ff1a1a; transform: scale(1.05); }

  /* Puzzle styles */
  #puzzleContainer { display: none; flex-direction: column; align-items: center; }
  #puzzle { display: grid; grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px); gap: 5px; margin-bottom: 20px; }
  .tile { width: 100px; height: 100px; background-size: 300px 300px; cursor: grab; border-radius: 8px; transition: transform 0.2s; }
  .tile.dragging { opacity: 0.6; transform: scale(1.05); }
  #puzzleMessage { font-size: 20px; color: #d60000; font-weight: bold; text-align: center; display: none; }

  @media (max-width: 400px){
    .box { font-size: 20px; max-width: 50px; height: 50px; }
    .key { font-size: 14px; height: 45px; }
    #shortMessage { font-size: 14px; }
    #loading { font-size: 16px; }
    #proceedBtn { font-size: 16px; padding: 8px 18px; }
    #puzzle { grid-template-columns: repeat(3, 90px); grid-template-rows: repeat(3, 90px); gap: 4px; }
    .tile { width: 90px; height: 90px; background-size: 270px 270px; }
  }
</style>
</head>
<body>

<div class="container" id="mainContainer">
  <h1 id="title">Will you be my Valentine?</h1>

  <div class="input-boxes" id="inputBoxes">
    <div class="box" id="box1"></div>
    <div class="box" id="box2"></div>
    <div class="box" id="box3"></div>
  </div>

  <div class="keyboard" id="keyboard">
    <div class="row" id="row1"></div>
    <div class="row" id="row2"></div>
    <div class="row" id="row3"></div>
  </div>

  <div id="message"></div>
  <div id="shortMessage">Please wait a few seconds while we prepare a surprise for you...</div>
  <div id="loading">LOADING<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span> <span id="countdown">8</span>s</div>
  <button id="proceedBtn">Proceed</button>
</div>

<!-- Puzzle Section -->
<div id="puzzleContainer">
  <h1>Complete the Puzzle!</h1>
  <div id="puzzle"></div>
  <div id="puzzleMessage">ðŸŽ‰ Congrats! Here's your hidden message! ðŸŽ‰</div>
</div>

<script>
/* Keyboard & Countdown */
const rows = {
  row1: ['Q','W','E','R','T','Y','U','I','O','P'],
  row2: ['A','S','D','F','G','H','J','K','L'],
  row3: ['-','Z','X','C','V','B','N','M','Del']
};

const clickable = ['Y','E','S'];
const special = ['N','O'];
const boxes = [document.getElementById('box1'), document.getElementById('box2'), document.getElementById('box3')];
const message = document.getElementById('message');
const keyboardDiv = document.getElementById('keyboard');
const mainContainer = document.getElementById('mainContainer');
const shortMessage = document.getElementById('shortMessage');
const loading = document.getElementById('loading');
const countdownEl = document.getElementById('countdown');
const proceedBtn = document.getElementById('proceedBtn');

let input = [];
let specialPressed = { N:false, O:false };

function createRow(rowId, letters) {
  const rowDiv = document.getElementById(rowId);
  letters.forEach(letter => {
    const key = document.createElement('div');
    key.classList.add('key');
    key.textContent = letter;

    if(clickable.includes(letter)){
      key.classList.add('highlight');
      key.addEventListener('click', () => handleInput(letter, '#d60000'));
    } else if(special.includes(letter)){
      key.classList.add('special');
      key.addEventListener('click', () => handleSpecial(letter, '#ff6600'));
    } else if(letter === 'Del'){
      key.classList.add('special');
      key.addEventListener('click', deleteInput);
    }

    rowDiv.appendChild(key);
  });
}

function handleInput(letter, color){
  if(input.length < 3){
    input.push({letter, color});
    updateBoxes();
    checkInput();
  }
}

function handleSpecial(letter, color){
  if(input.length < 3){
    input.push({letter, color});
    updateBoxes();
    specialPressed[letter] = true;
    if(letter === 'O'){ /* crying sound could be added */ }
    if(specialPressed['N'] && specialPressed['O']){
      message.textContent = "PLEASE!! ðŸ™";
    }
  }
}

function deleteInput(){
  if(input.length > 0){
    const removed = input.pop();
    updateBoxes();
    if(special.includes(removed.letter)){
      specialPressed[removed.letter] = false;
    }
    message.textContent = "";
  }
}

function updateBoxes(){
  for(let i=0;i<3;i++){
    if(input[i]){
      boxes[i].textContent = input[i].letter;
      boxes[i].style.backgroundColor = input[i].color;
    } else {
      boxes[i].textContent = '';
      boxes[i].style.backgroundColor = '#fff';
    }
  }
}

function checkInput(){
  if(input.length === 3 && input.map(x=>x.letter).join('') === "YES"){
    keyboardDiv.classList.add('hidden');
    shortMessage.style.display = "block";
    loading.style.display = "block";

    let countdown = 8;
    countdownEl.textContent = countdown;

    const interval = setInterval(() => {
      countdown--;
      countdownEl.textContent = countdown;
      if(countdown <= 0){
        clearInterval(interval);
        proceedBtn.style.display = "block";
      }
    }, 1000);
  }
}

createRow('row1', rows.row1);
createRow('row2', rows.row2);
createRow('row3', rows.row3);

proceedBtn.addEventListener('click', () => {
  mainContainer.style.display = 'none'; // hide keyboard/inputs
  document.getElementById('puzzleContainer').style.display = 'flex'; // show puzzle
  initPuzzle();
});

/* Puzzle Logic */
const puzzle = document.getElementById('puzzle');
const puzzleMessage = document.getElementById('puzzleMessage');
const gridSize = 3;
const imageUrl = 'IMAGES/22.jpg';
let tiles = [];

function initPuzzle(){
  puzzle.innerHTML = '';
  tiles = [];

  for(let row=0; row<gridSize; row++){
    for(let col=0; col<gridSize; col++){
      let tile = document.createElement('div');
      tile.classList.add('tile');
      tile.style.backgroundImage = `url(${imageUrl})`;
      tile.style.backgroundPosition = `-${col*100}px -${row*100}px`;
      tile.dataset.correct = row*gridSize + col;
      tile.dataset.current = row*gridSize + col;
      tile.draggable = true;
      puzzle.appendChild(tile);
      tiles.push(tile);
    }
  }

  // Shuffle tiles
  for(let i=tiles.length-1;i>0;i--){
    let j = Math.floor(Math.random()* (i+1));
    [tiles[i].dataset.current, tiles[j].dataset.current] = [tiles[j].dataset.current, tiles[i].dataset.current];
    [tiles[i].style.backgroundPosition, tiles[j].style.backgroundPosition] = [tiles[j].style.backgroundPosition, tiles[i].style.backgroundPosition];
  }

  // Drag and Drop
  let dragged = null;
  tiles.forEach(tile=>{
    tile.addEventListener('dragstart', e=>{ dragged=tile; tile.classList.add('dragging'); });
    tile.addEventListener('dragend', e=>{ tile.classList.remove('dragging'); checkPuzzle(); });
    tile.addEventListener('dragover', e=>e.preventDefault());
    tile.addEventListener('drop', e=>{
      e.preventDefault();
      if(dragged === tile) return;
      // swap current positions
      let temp = dragged.dataset.current;
      dragged.dataset.current = tile.dataset.current;
      tile.dataset.current = temp;
      // swap visuals
      let tempPos = dragged.style.backgroundPosition;
      dragged.style.backgroundPosition = tile.style.backgroundPosition;
      tile.style.backgroundPosition = tempPos;
    });
  });
}

function checkPuzzle(){
  if(tiles.every(tile=>tile.dataset.current === tile.dataset.correct)){
    puzzleMessage.style.display = 'block';
  }
}
</script>

</body>
</html>
