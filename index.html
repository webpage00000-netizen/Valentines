<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Surprise</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  #loadingScreen {
    position: fixed; inset: 0;
    background: #f9fafc;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 9999;
    font-family: 'Montserrat', sans-serif;
    overflow: hidden;
    transition: opacity 0.8s ease;
  }
  .cat-wrapper {
    padding: 12px; border-radius: 22px;
    background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.06);
    margin-bottom: 20px;
  }
  .cat {
    width: 170px; max-width: 60vw;
    border-radius: 18px; border: 1.5px solid #ffd6e8;
  }
  .loading-text { font-size: 18px; color: #666; }
  .countdown {
    font-size: 55px; font-weight: 700;
    color: #ff6fa5; margin-top: 15px;
    opacity: 0; transition: 0.4s;
  }
  .show { opacity: 1; transform: scale(1.1); }
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #ffe6e6, #fff0f5);
    display: flex; flex-direction: column; align-items: center;
    padding: 20px; min-height: 100vh;
  }
  .container {
    display: flex; flex-direction: column; align-items: center;
    width: 100%; max-width: 450px;
    transition: 1.5s ease;
  }
  h1 {
    font-family: 'Fredoka One', cursive;
    color: #d60000; font-size: 2em;
    text-align: center; margin-bottom: 20px;
  }
  .input-boxes { display: flex; gap: 10px; margin-bottom: 15px; }
  .box {
    width: 60px; height: 60px;
    border: 3px solid #d60000; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; font-weight: bold;
    background: #fff; color: #fff;
  }
  .keyboard { display: flex; flex-direction: column; gap: 10px; width: 100%; }
  .keyboard.hidden { opacity: 0; pointer-events: none; }
  .row { display: flex; justify-content: center; gap: 5px; }
  .key {
    flex: 1; height: 50px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    background: #ccc; color: white; font-weight: bold;
    cursor: not-allowed; transition: 0.2s;
  }
  .key.highlight { background: #d60000; cursor: pointer; }
  .key.highlight:hover { transform: scale(1.1); }
  .key.special { background: #ff6600; cursor: pointer; }
  .key.special:hover { transform: scale(1.1); }
  #message { margin-top: 10px; font-size: 20px; color: #d60000; font-weight: 600; text-align: center; }
  #shortMessage { margin-top: 10px; font-size: 16px; color: #333; text-align: center; display: none; }
  #loading { font-size: 18px; margin-top: 10px; display: none; text-align: center; }
  .dot { animation: blink 1s infinite; }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes blink { 0%,50%,100% { opacity: 0; } 25%,75% { opacity: 1; } }
  #proceedBtn {
    margin-top: 20px; padding: 10px 20px;
    font-size: 18px; background: #d60000; color: white;
    border: none; border-radius: 10px; cursor: pointer;
    display: none; transition: 0.2s;
  }
  #proceedBtn:hover { background: #ff1a1a; transform: scale(1.05); }
  #puzzleContainer { display: none; flex-direction: column; align-items: center; }
  #puzzleInstruction { margin-bottom: 10px; text-align: center; font-size: 16px; color: #333; }
  #puzzle {
    display: grid; grid-template-columns: repeat(3, 100px);
    grid-template-rows: repeat(3, 100px); gap: 5px;
    margin-bottom: 20px;
  }
  .tile {
    width: 100px; height: 100px;
    background-size: 300px 300px; cursor: grab;
    border-radius: 8px; transition: all 0.6s ease;
    transform-style: preserve-3d;
  }
  .tile.dragging { opacity: 0.6; transform: scale(1.05); }
  #mergedReveal {
    display: none; justify-content: center; margin: 30px 0 20px;
  }
  #greyCard {
    width: 300px; height: 300px;
    background: #444;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 1.4em; font-weight: bold;
    cursor: pointer; transition: all 0.6s ease;
  }
  #tapTextFinal { display: none; margin-top: 16px; color: #444; font-size: 17px; }
  #shortMessageFinal {
    display: none; margin: 16px 0;
    font-size: 18px; color: #d60000; font-weight: 600;
    text-align: center; max-width: 90%;
  }
  #nextAfterTap {
    display: none; padding: 12px 28px;
    font-size: 18px; background: #d60000; color: white;
    border: none; border-radius: 12px; cursor: pointer;
  }
  #nextAfterTap:hover { background: #ff1a1a; transform: scale(1.05); }
</style>
</head>
<body>

<div id="loadingScreen">
  <div class="cat-wrapper">
    <img class="cat" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" alt="cat">
  </div>
  <div class="loading-text">This will take a few seconds</div>
  <div class="loading-text">Get ready...</div>
  <div class="countdown" id="countdown"></div>
</div>

<audio id="popSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

<div class="container" id="mainContainer" style="display:none;">
  <h1>Will you be my Valentine?</h1>
  <div class="input-boxes">
    <div class="box" id="box1"></div>
    <div class="box" id="box2"></div>
    <div class="box" id="box3"></div>
  </div>
  <div class="keyboard" id="keyboard">
    <div class="row" id="row1"></div>
    <div class="row" id="row2"></div>
    <div class="row" id="row3"></div>
  </div>
  <div id="message"></div>
  <div id="shortMessage">Please wait a few seconds while we prepare a surprise for you...</div>
  <div id="loading">LOADING<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span> <span id="countdown8">8</span>s</div>
  <button id="proceedBtn">Proceed</button>
</div>

<div id="puzzleContainer">
  <h1>Complete the Puzzle!</h1>
  <div id="puzzleInstruction">Drag pieces to solve.</div>
  <div id="puzzle"></div>
  <div id="mergedReveal">
    <div id="greyCard">Tap me ‚ô•</div>
  </div>
  <div id="tapTextFinal">Tap the card ‚Üë</div>
  <div id="shortMessageFinal"></div>
  <button id="nextAfterTap">Next</button>
</div>

<script>
// LOADING
const loadingScreen = document.getElementById("loadingScreen");
const countdownEl = document.getElementById("countdown");
const pop = document.getElementById("popSound");
let count = 5;
setTimeout(() => {
  countdownEl.classList.add("show");
  countdownEl.innerText = "In " + count;
  pop.play();
  const interval = setInterval(() => {
    countdownEl.classList.remove("show");
    setTimeout(() => {
      count--;
      if (count > 0) {
        countdownEl.innerText = "In " + count;
        countdownEl.classList.add("show");
        pop.currentTime = 0; pop.play();
      } else {
        clearInterval(interval);
        loadingScreen.style.opacity = "0";
        setTimeout(() => {
          loadingScreen.style.display = "none";
          document.getElementById("mainContainer").style.display = "flex";
        }, 800);
      }
    }, 300);
  }, 1000);
}, 1500);

// KEYBOARD PART
const box1 = document.getElementById('box1');
const box2 = document.getElementById('box2');
const box3 = document.getElementById('box3');
const boxes = [box1, box2, box3];
const rows = {
  row1: ['Q','W','E','R','T','Y','U','I','O','P'],
  row2: ['A','S','D','F','G','H','J','K','L'],
  row3: ['-','Z','X','C','V','B','N','M','Del']
};
const clickable = ['Y','E','S'];
const special = ['N','O'];
const message = document.getElementById('message');
let input = [], specialPressed = { N: false, O: false };

function createRow(id, letters) {
  const row = document.getElementById(id);
  letters.forEach(letter => {
    const key = document.createElement("div");
    key.classList.add("key");
    key.textContent = letter;
    if (clickable.includes(letter)) {
      key.classList.add("highlight");
      key.onclick = () => handleInput(letter);
    } else if (special.includes(letter)) {
      key.classList.add("special");
      key.onclick = () => handleSpecial(letter);
    } else if (letter === "Del") {
      key.classList.add("special");
      key.onclick = deleteInput;
    }
    row.appendChild(key);
  });
}

function handleInput(letter) {
  if (input.length < 3) {
    input.push(letter);
    updateBoxes();
    checkInput();
  }
}

function handleSpecial(letter) {
  if (input.length < 3) {
    input.push(letter);
    specialPressed[letter] = true;
    updateBoxes();
    if (specialPressed.N && specialPressed.O) message.textContent = "PLEASE!! üôè";
  }
}

function deleteInput() {
  if (input.length > 0) {
    const removed = input.pop();
    if (special.includes(removed)) {
      specialPressed[removed] = false;
      message.textContent = "";
    }
    updateBoxes();
  }
}

function updateBoxes() {
  boxes.forEach((box, i) => {
    box.textContent = input[i] || "";
    box.style.backgroundColor = input[i] ? "#d60000" : "#fff";
  });
}

function checkInput() {
  if (input.join("") === "YES") {
    document.getElementById('keyboard').classList.add("hidden");
    document.getElementById('shortMessage').style.display = "block";
    document.getElementById('loading').style.display = "block";
    let c = 8;
    const interval = setInterval(() => {
      c--;
      document.getElementById('countdown8').textContent = c;
      if (c <= 0) {
        clearInterval(interval);
        document.getElementById('proceedBtn').style.display = "block";
      }
    }, 1000);
  }
}

createRow("row1", rows.row1);
createRow("row2", rows.row2);
createRow("row3", rows.row3);

document.getElementById('proceedBtn').onclick = () => {
  document.getElementById('mainContainer').style.display = "none";
  document.getElementById('puzzleContainer').style.display = "flex";
  initPuzzle();
};

// PUZZLE PART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const puzzle = document.getElementById('puzzle');
const puzzleInstruction = document.getElementById('puzzleInstruction');
const imageUrl = './IMAGES/22.jpg';   // ‚Üê try full raw url if still issues

function initPuzzle() {
  puzzle.innerHTML = '';
  for (let row = 0; row < 3; row++) {
    for (let col = 0; col < 3; col++) {
      const tile = document.createElement('div');
      tile.classList.add('tile');
      tile.style.backgroundImage = `url(${imageUrl})`;
      tile.style.backgroundPosition = `-${col*100}px -${row*100}px`;
      tile.draggable = true;
      puzzle.appendChild(tile);
    }
  }

  // shuffle
  const tiles = [...puzzle.children];
  tiles.sort(() => Math.random() - 0.5);
  tiles.forEach(t => puzzle.appendChild(t));

  let dragged = null;
  tiles.forEach(tile => {
    tile.addEventListener('dragstart', () => {
      dragged = tile;
      tile.classList.add('dragging');
    });
    tile.addEventListener('dragend', () => tile.classList.remove('dragging'));
    tile.addEventListener('dragover', e => e.preventDefault());
    tile.addEventListener('drop', e => {
      e.preventDefault();
      if (dragged && dragged !== tile) {
        const temp = dragged.style.backgroundPosition;
        dragged.style.backgroundPosition = tile.style.backgroundPosition;
        tile.style.backgroundPosition = temp;
        setTimeout(checkPuzzle, 80);   // small delay helps
      }
    });
  });
}

function normalizePos(str) {
  if (!str) return '';
  return str
    .replace(/\s+/g, ' ')
    .replace(/,/g, ' ')
    .trim()
    .toLowerCase();
}

function checkPuzzle() {
  console.log("Checking puzzle...");

  const tiles = [...puzzle.children];
  let solved = true;

  tiles.forEach((tile, i) => {
    const cx = `-${(i % 3) * 100}px`;
    const cy = `-${Math.floor(i / 3) * 100}px`;
    const expected = normalizePos(`${cx} ${cy}`);

    const actual = normalizePos(tile.style.backgroundPosition);

    console.log(`Position ${i}: expected "${expected}" | got "${actual}"`);

    if (actual !== expected) solved = false;
  });

  if (solved) {
    console.log("SOLVED ‚Üí starting flip animation");

    tiles.forEach((tile, i) => {
      setTimeout(() => {
        tile.style.transition = 'all 0.6s ease';
        tile.style.transform = 'rotateY(180deg)';
        tile.style.backgroundImage = 'none';
        tile.style.backgroundColor = '#444';
      }, i * 160 + 100);
    });

    setTimeout(() => {
      puzzle.style.display = 'none';
      puzzleInstruction.style.display = 'none';
      const reveal = document.getElementById('mergedReveal');
      reveal.style.display = 'flex';

      const card = document.getElementById('greyCard');
      card.style.opacity = '0';
      card.style.transform = 'scale(0.8)';

      setTimeout(() => {
        card.style.transition = 'all 0.9s ease';
        card.style.opacity = '1';
        card.style.transform = 'scale(1)';
        document.getElementById('tapTextFinal').style.display = 'block';
      }, 120);
    }, 9 * 160 + 800);
  }
}

// CARD TAP
document.getElementById('greyCard').onclick = () => {
  const card = document.getElementById('greyCard');
  const tapTxt = document.getElementById('tapTextFinal');
  const msg = document.getElementById('shortMessageFinal');
  const btn = document.getElementById('nextAfterTap');

  card.style.transition = 'all 0.7s ease';
  card.style.transform = 'rotateY(180deg) scale(1.05)';
  card.style.background = 'linear-gradient(135deg, #ff6fa5, #d60000)';
  card.innerHTML = '‚ô° Opened! ‚ô°';
  tapTxt.style.display = 'none';

  setTimeout(() => {
    msg.style.display = 'block';
    msg.textContent = "You're my favorite person in the whole world ‚ô• Will you be my Valentine forever?";
    btn.style.display = 'inline-block';
  }, 700);
};

// NEXT
document.getElementById('nextAfterTap').onclick = () => {
  alert("Yayyyy! üíï Now comes the biggest hug everrrr!");
};
</script>
</body>
</html>
