<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Surprise</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}

/* ========== LOADING SCREEN ========== */
#loadingScreen{
  position:fixed; inset:0;
  background:#f9fafc;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  z-index:9999; font-family:'Montserrat',sans-serif;
  overflow:hidden; transition:opacity 0.8s ease;
}
.cat-wrapper{
  padding:12px;
  border-radius:22px;
  background:white;
  box-shadow:0 10px 25px rgba(0,0,0,0.06);
  margin-bottom:20px;
}
.cat{
  width:170px;
  max-width:60vw;
  border-radius:18px;
  border:1.5px solid #ffd6e8;
}
.loading-text{font-size:18px;color:#666;}
.countdown{font-size:55px;font-weight:700;color:#ff6fa5;margin-top:15px;opacity:0;transition:0.4s;}
.show{opacity:1;transform:scale(1.1);}
.heart{position:absolute;bottom:-20px;font-size:20px;color:#ff9ecf;animation:floatUp linear forwards;}
@keyframes floatUp{0%{transform:translateY(0);opacity:0.8;}100%{transform:translateY(-110vh);opacity:0;}}

/* ========== MAIN PAGE ========== */
body{
  font-family:'Montserrat', sans-serif;
  background: linear-gradient(135deg,#ffe6e6,#fff0f5);
  display:flex; flex-direction:column;
  align-items:center; padding:20px; min-height:100vh;
}
.container{
  display:flex; flex-direction:column; align-items:center;
  width:100%; max-width:450px; transition:1.5s ease;
}
h1{
  font-family:'Fredoka One',cursive;
  color:#d60000;
  font-size:2em;
  text-align:center;
  margin-bottom:20px;
}
.input-boxes{display:flex;gap:10px;margin-bottom:15px;}
.box{
  width:60px;height:60px;border:3px solid #d60000;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:24px;font-weight:bold;background:#fff;color:#fff;
}
.keyboard{display:flex;flex-direction:column;gap:10px;width:100%;}
.keyboard.hidden{opacity:0;pointer-events:none;}
.row{display:flex;justify-content:center;gap:5px;}
.key{
  flex:1;height:50px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  background:#ccc;color:white;font-weight:bold;
  cursor:not-allowed;transition:0.2s;
}
.key.highlight{background:#d60000;cursor:pointer;}
.key.highlight:hover{transform:scale(1.1);}
.key.special{background:#ff6600;cursor:pointer;}
.key.special:hover{transform:scale(1.1);}
#message{margin-top:10px;font-size:20px;color:#d60000;font-weight:600;text-align:center;}
#shortMessage{margin-top:10px;font-size:16px;color:#333;text-align:center;display:none;}
#loading{font-size:18px;margin-top:10px;display:none;text-align:center;}
.dot{animation:blink 1s infinite;}
.dot:nth-child(2){animation-delay:0.2s;}
.dot:nth-child(3){animation-delay:0.4s;}
@keyframes blink{0%,50%,100%{opacity:0;}25%,75%{opacity:1;}}
#proceedBtn{margin-top:20px;padding:10px 20px;font-size:18px;background:#d60000;color:white;border:none;border-radius:10px;cursor:pointer;display:none;transition:0.2s;}
#proceedBtn:hover{background:#ff1a1a;transform:scale(1.05);}

/* ========== PUZZLE ========== */
#puzzleContainer{display:none;flex-direction:column;align-items:center;}
#puzzleInstruction{margin-bottom:10px;text-align:center;font-size:16px;color:#333;}
#puzzle{display:grid;grid-template-columns:repeat(3,100px);grid-template-rows:repeat(3,100px);gap:5px;margin-bottom:20px;}
.tile{width:100px;height:100px;background-size:300px 300px;cursor:grab;border-radius:8px;transition:0.2s;transform-style: preserve-3d;}
.tile.dragging{opacity:0.6;transform:scale(1.05);}
.tile.flip{transform:rotateY(180deg);transition:0.6s ease;}

/* ========== POLAROID ========== */
#polaroidContainer{display:none; flex-direction:column; align-items:center; margin-top:20px; cursor:pointer;}
#polaroid{width:300px; height:300px; border-radius:12px; background:url('IMAGES/21.jpg') center/cover no-repeat; box-shadow:0 8px 15px rgba(0,0,0,0.3); transition:transform 0.6s; transform-style: preserve-3d; position:relative;}
#polaroidBack{position:absolute; inset:0; background:white; border-radius:12px; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; font-size:20px; color:#d60000; font-weight:bold; transform:rotateY(180deg);}
#tapText{margin-top:10px; font-size:16px; color:#333;}
#nextAfterFlip{display:none; margin-top:15px; padding:10px 20px; border:none; border-radius:10px; background:#d60000; color:white; cursor:pointer;}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingScreen">
  <div class="cat-wrapper"><img class="cat" src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"></div>
  <div class="loading-text">This will take a few seconds</div>
  <div class="loading-text">Get ready...</div>
  <div class="countdown" id="countdown"></div>
</div>
<audio id="popSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

<!-- MAIN -->
<div class="container" id="mainContainer" style="display:none;">
  <h1>Will you be my Valentine?</h1>
  <div class="input-boxes">
    <div class="box" id="box1"></div>
    <div class="box" id="box2"></div>
    <div class="box" id="box3"></div>
  </div>
  <div class="keyboard" id="keyboard">
    <div class="row" id="row1"></div>
    <div class="row" id="row2"></div>
    <div class="row" id="row3"></div>
  </div>
  <div id="message"></div>
  <div id="shortMessage">Please wait a few seconds while we prepare a surprise for you...</div>
  <div id="loading">LOADING<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span> <span id="countdown8">8</span>s</div>
  <button id="proceedBtn">Proceed</button>
</div>

<!-- PUZZLE + POLAROID -->
<div id="puzzleContainer">
  <h1>Complete the Puzzle!</h1>
  <div id="puzzleInstruction"></div>
  <div id="puzzle"></div>

  <div id="polaroidContainer">
    <div id="polaroid">
      <div id="polaroidBack">Your short message</div>
    </div>
    <div id="tapText">Tap the photo</div>
    <button id="nextAfterFlip">Next</button>
  </div>
</div>

<!-- GREY BOX FOR PUZZLE REVEAL -->
<div id="greyReveal" style="display:none; width:200px; height:200px; background:grey; align-items:center; justify-content:center;"></div>
<div id="tapTextFinal" style="display:none;">Tap me â†‘</div>
<div id="shortMessageFinal" style="display:none;">Your short message</div>
<button id="nextAfterTap" style="display:none;">Next</button>


<script>
/* ===== LOADING COUNTDOWN ===== */
const loadingScreen = document.getElementById("loadingScreen");
const countdownEl = document.getElementById("countdown");
const pop = document.getElementById("popSound");
let count = 5;

// Start countdown immediately after 1.5s
setTimeout(() => {
  function tick() {
    if (count > 0) {
      countdownEl.textContent = "In " + count;
      countdownEl.classList.add("show");
      pop.currentTime = 0; 
      pop.play();
      count--;
      setTimeout(() => {
        countdownEl.classList.remove("show");
        setTimeout(tick, 500); // wait 0.5s then next tick
      }, 700); // keep number visible 0.7s
    } else {
      // Done
      loadingScreen.style.opacity = "0";
      setTimeout(() => {
        loadingScreen.style.display = "none";
        document.getElementById("mainContainer").style.display = "flex";
      }, 800);
    }
  }
  tick();
}, 1500);


/* ===== KEYBOARD ===== */
const rows={row1:['Q','W','E','R','T','Y','U','I','O','P'],row2:['A','S','D','F','G','H','J','K','L'],row3:['-','Z','X','C','V','B','N','M','Del']};
const clickable=['Y','E','S'],special=['N','O'];
// âœ… Fix: get boxes properly
const boxes = [
  document.getElementById('box1'),
  document.getElementById('box2'),
  document.getElementById('box3')
];

let input=[], specialPressed={N:false,O:false};
let input=[],specialPressed={N:false,O:false};

function createRow(id,letters){
  const row=document.getElementById(id);
  letters.forEach(letter=>{
    const key=document.createElement("div");
    key.classList.add("key"); key.textContent=letter;
    if(clickable.includes(letter)){key.classList.add("highlight"); key.onclick=()=>handleInput(letter);}
    else if(special.includes(letter)){key.classList.add("special"); key.onclick=()=>handleSpecial(letter);}
    else if(letter==="Del"){key.classList.add("special"); key.onclick=deleteInput;}
    row.appendChild(key);
  });
}
function handleInput(letter){if(input.length<3){input.push(letter);updateBoxes();checkInput();}}
function handleSpecial(letter){if(input.length<3){input.push(letter);specialPressed[letter]=true;updateBoxes();if(specialPressed.N && specialPressed.O) message.textContent="PLEASE!! ðŸ™";}}
function deleteInput(){if(input.length>0){const removed=input.pop();if(special.includes(removed)){specialPressed[removed]=false;message.textContent="";}updateBoxes();}}
function updateBoxes(){boxes.forEach((box,i)=>{box.textContent=input[i]||"";box.style.backgroundColor=input[i]?"#d60000":"#fff";});}
function checkInput(){if(input.join("")==="YES"){keyboard.classList.add("hidden");shortMessage.style.display="block";loading.style.display="block";let c=8; const interval=setInterval(()=>{c--;countdown8.textContent=c;if(c<=0){clearInterval(interval);proceedBtn.style.display="block";}},1000);}}
createRow("row1",rows.row1); createRow("row2",rows.row2); createRow("row3",rows.row3);

proceedBtn.onclick=()=>{mainContainer.style.display="none";puzzleContainer.style.display="flex";initPuzzle();};

/* ===== PUZZLE ===== */
const puzzle=document.getElementById('puzzle');
const puzzleInstruction=document.getElementById('puzzleInstruction');
const polaroidContainer=document.getElementById('polaroidContainer');
const polaroid=document.getElementById('polaroid');
const polaroidBack=document.getElementById('polaroidBack');
const tapText=document.getElementById('tapText');
const nextAfterFlip=document.getElementById('nextAfterFlip');
const gridSize=3;
const imageUrl='IMAGES/21.jpg';
let tiles=[];

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

function initPuzzle(){
  puzzleInstruction.textContent=/Mobi|Android/i.test(navigator.userAgent) ? 
    "On mobile: Hold the piece then drag it to swap." : "On desktop: Click and drag the piece to swap.";
  puzzle.innerHTML=''; tiles=[];
  for(let row=0;row<gridSize;row++){
    for(let col=0;col<gridSize;col++){
      let tile=document.createElement('div'); tile.classList.add('tile');
      tile.style.backgroundImage=`url(${imageUrl})`;
      tile.style.backgroundPosition=`-${col*100}px -${row*100}px`;
      tile.dataset.correct=row*gridSize+col; tile.dataset.current=row*gridSize+col;
      tile.draggable=true;
      puzzle.appendChild(tile); tiles.push(tile);
    }
  }

  // Properly shuffle tiles visually and dataset.current
  let currentPositions = tiles.map((t,i)=>i);
  currentPositions = currentPositions.sort(()=>Math.random()-0.5);
  tiles.forEach((tile,i)=>{
    let pos = currentPositions[i];
    let correctCol = pos % gridSize;
    let correctRow = Math.floor(pos / gridSize);
    tile.dataset.current = pos;
    tile.style.backgroundPosition = `-${correctCol*100}px -${correctRow*100}px`;
  });

  let dragged=null;
  tiles.forEach(tile=>{
    tile.addEventListener('dragstart',()=>{ dragged=tile; tile.classList.add('dragging'); });
    tile.addEventListener('dragend',()=>{ tile.classList.remove('dragging'); checkPuzzle(); });
    tile.addEventListener('dragover',e=>e.preventDefault());
    tile.addEventListener('drop',e=>{ e.preventDefault(); if(dragged===tile) return;
      // Swap dataset.current and backgroundPosition
      let temp = dragged.dataset.current;
      dragged.dataset.current = tile.dataset.current;
      tile.dataset.current = temp;
      let tempPos = dragged.style.backgroundPosition;
      dragged.style.backgroundPosition = tile.style.backgroundPosition;
      tile.style.backgroundPosition = tempPos;
    });
  });
}

function checkPuzzle(){
  const solved = tiles.every(tile => tile.dataset.current === tile.dataset.correct);
  if(solved){
    // Flip tiles sequentially
    tiles.forEach((tile,index)=>{ setTimeout(()=>{ tile.classList.add('flip'); }, index*200); });
    
    // After all flips, show grey box and "tap me"
    setTimeout(()=>{
      puzzle.style.display='none';
      puzzleInstruction.style.display='none';
      // Show grey box
      const grey = document.getElementById('greyReveal');
      const tapText = document.getElementById('tapTextFinal');
      grey.style.display='flex';
      tapText.style.display='block';
    }, tiles.length*200 + 600);
  }
}

// Tap logic for grey box
const greyBox = document.getElementById('greyReveal');
const tapText = document.getElementById('tapTextFinal');
const shortMsg = document.getElementById('shortMessageFinal');
const nextBtn = document.getElementById('nextAfterTap');

greyBox.addEventListener('click', ()=>{
  shortMsg.style.display='block';
  nextBtn.style.display='inline-block';
  tapText.style.display='none';
});

nextBtn.addEventListener('click', ()=>{
  alert("Proceed to the next page...");
});

nextAfterFlip.addEventListener('click',()=>alert("Proceed to the next page..."));
</script>
</body>
</html>
